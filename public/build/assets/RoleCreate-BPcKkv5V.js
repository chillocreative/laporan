import{o as L,c as o,a as s,f as y,g as x,s as U,w as $,t as c,d as _,e as f,v as h,F as k,q as C,i as z,r as m,j as D,k as i,h as b,L as E}from"./app-CQob2CXV.js";import{u as I}from"./useNotification-q_vuiReD.js";import{r as w}from"./roles-Db10dzzm.js";import{_ as K}from"./LoadingSpinner-C2gbwHS5.js";/* empty css            */import"./notifications-DGFlpOIp.js";const O={class:"max-w-3xl mx-auto"},R={class:"mb-6"},A={key:1,class:"card"},H={class:"card-body"},J={key:0,class:"rounded-lg bg-red-50 p-3 text-sm text-red-700"},Q={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},W={class:"space-y-4"},X={class:"flex items-center gap-3 mb-3"},Y=["id","checked","indeterminate","onChange"],Z=["for"],N={class:"text-xs text-gray-400"},ee={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2 ml-7"},se=["value"],te={key:0,class:"text-sm text-gray-400 mt-2"},ae={class:"flex items-center justify-end gap-3 pt-4 border-t border-gray-100"},ne=["disabled"],pe={__name:"RoleCreate",setup(le){const P=D(),S=I(),t=m({name:"",slug:"",permissions:[]}),u=m({}),v=m(!0),g=m(!1),p=m("");function M(){t.value.slug=t.value.name.toLowerCase().trim().replace(/[^a-z0-9\s-]/g,"").replace(/[\s]+/g,"-").replace(/-+/g,"-")}function V(n){const e=u.value[n]||[];return e.length>0&&e.every(r=>t.value.permissions.includes(r.id))}function B(n){const e=u.value[n]||[],r=e.filter(l=>t.value.permissions.includes(l.id)).length;return r>0&&r<e.length}function G(n){return(u.value[n]||[]).filter(r=>t.value.permissions.includes(r.id)).length}function j(n,e){const l=(u.value[n]||[]).map(a=>a.id);if(e){const a=new Set(t.value.permissions);l.forEach(d=>a.add(d)),t.value.permissions=[...a]}else t.value.permissions=t.value.permissions.filter(a=>!l.includes(a))}async function T(){v.value=!0;try{const{data:n}=await w.permissions();u.value=n.data}catch{p.value="Gagal memuatkan kebenaran."}v.value=!1}async function q(){g.value=!0,p.value="";try{await w.create({name:t.value.name,slug:t.value.slug,permission_ids:t.value.permissions}),S.success("Peranan berjaya dicipta!"),P.push({name:"roles.index"})}catch(n){const e=n.response?.data?.errors;p.value=e?Object.values(e).flat()[0]:"Gagal mencipta peranan."}finally{g.value=!1}}return L(()=>T()),(n,e)=>{const r=z("router-link");return i(),o("div",O,[s("div",R,[y(r,{to:{name:"roles.index"},class:"text-sm text-gray-500 hover:text-primary-600 mb-1 inline-block"},{default:x(()=>[...e[3]||(e[3]=[b("â† Kembali ke Peranan",-1)])]),_:1}),e[4]||(e[4]=s("h1",{class:"page-title"},"Cipta Peranan Baru",-1)),e[5]||(e[5]=s("p",{class:"page-subtitle"},"Tentukan peranan baru dengan kebenaran khusus",-1))]),v.value?(i(),U(K,{key:0,"full-page":""})):(i(),o("div",A,[s("div",H,[s("form",{onSubmit:$(q,["prevent"]),class:"space-y-6"},[p.value?(i(),o("div",J,c(p.value),1)):_("",!0),s("div",Q,[s("div",null,[e[6]||(e[6]=s("label",{class:"label-text"},"Nama Peranan *",-1)),f(s("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>t.value.name=l),onInput:M,type:"text",required:"",class:"input-field",placeholder:"e.g. Content Manager"},null,544),[[h,t.value.name]])]),s("div",null,[e[7]||(e[7]=s("label",{class:"label-text"},"Slug *",-1)),f(s("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>t.value.slug=l),type:"text",required:"",class:"input-field",placeholder:"e.g. content-manager"},null,512),[[h,t.value.slug]])])]),s("div",null,[e[8]||(e[8]=s("label",{class:"label-text mb-3"},"Kebenaran",-1)),s("div",W,[(i(!0),o(k,null,C(u.value,(l,a)=>(i(),o("div",{key:a,class:"border border-gray-200 rounded-lg p-4"},[s("div",X,[s("input",{type:"checkbox",id:`group-${a}`,checked:V(a),indeterminate:B(a),onChange:d=>j(a,d.target.checked),class:"h-4 w-4 text-primary-600 rounded border-gray-300 focus:ring-primary-500"},null,40,Y),s("label",{for:`group-${a}`,class:"text-sm font-semibold text-gray-700 capitalize"},c(a),9,Z),s("span",N," ("+c(G(a))+"/"+c(l.length)+") ",1)]),s("div",ee,[(i(!0),o(k,null,C(l,d=>(i(),o("label",{key:d.id,class:"flex items-center gap-2 text-sm text-gray-600 cursor-pointer"},[f(s("input",{type:"checkbox",value:d.id,"onUpdate:modelValue":e[2]||(e[2]=F=>t.value.permissions=F),class:"h-4 w-4 text-primary-600 rounded border-gray-300 focus:ring-primary-500"},null,8,se),[[E,t.value.permissions]]),b(" "+c(d.name),1)]))),128))])]))),128))]),Object.keys(u.value).length?_("",!0):(i(),o("p",te,"Tiada kebenaran tersedia."))]),s("div",ae,[y(r,{to:{name:"roles.index"},class:"btn-secondary"},{default:x(()=>[...e[9]||(e[9]=[b("Batal",-1)])]),_:1}),s("button",{type:"submit",disabled:g.value,class:"btn-primary"},c(g.value?"Mencipta...":"Cipta Peranan"),9,ne)])],32)])]))])}}};export{pe as default};
