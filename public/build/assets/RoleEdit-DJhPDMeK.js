import{r as c,o as U,c as i,a as s,f as R,g as b,s as V,F as x,d as h,w as z,t as m,e as _,v as M,q as B,n as O,i as A,j as N,k as r,h as f,L as H}from"./app-CkgA-AoW.js";import{u as J}from"./useNotification-Dz5CEwoZ.js";import{r as k}from"./roles-BZvqwXPl.js";import{_ as K}from"./LoadingSpinner-B-34TY8e.js";import{_ as Q}from"./Alert-DKpLLnRQ.js";/* empty css            */import"./notifications-lGq0ZMx-.js";const W={class:"max-w-3xl mx-auto"},X={class:"mb-6"},Y={class:"card"},Z={class:"card-body"},ee={key:0,class:"rounded-lg bg-red-50 p-3 text-sm text-red-700"},se={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},te={class:"space-y-4"},ae={class:"flex items-center gap-3 mb-3"},le=["id","checked","indeterminate","onChange"],oe=["for"],ne={class:"text-xs text-gray-400"},re={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2 ml-7"},ie=["value"],ue={key:0,class:"text-sm text-gray-400 mt-2"},de={class:"flex items-center justify-end gap-3 pt-4 border-t border-gray-100"},ce=["disabled"],xe={__name:"RoleEdit",props:{id:[String,Number]},setup(F){const P=F,j=O(),w=N(),C=J(),S=c(P.id||j.params.id),p=c(null),t=c({name:"",slug:"",permissions:[]}),u=c({}),y=c(!0),v=c(!1),g=c("");function E(){t.value.slug=t.value.name.toLowerCase().trim().replace(/[^a-z0-9\s-]/g,"").replace(/[\s]+/g,"-").replace(/-+/g,"-")}function G(l){const e=u.value[l]||[];return e.length>0&&e.every(o=>t.value.permissions.includes(o.id))}function $(l){const e=u.value[l]||[],o=e.filter(n=>t.value.permissions.includes(n.id)).length;return o>0&&o<e.length}function q(l){return(u.value[l]||[]).filter(o=>t.value.permissions.includes(o.id)).length}function D(l,e){const n=(u.value[l]||[]).map(a=>a.id);if(e){const a=new Set(t.value.permissions);n.forEach(d=>a.add(d)),t.value.permissions=[...a]}else t.value.permissions=t.value.permissions.filter(a=>!n.includes(a))}async function I(){y.value=!0;try{const[l,e]=await Promise.all([k.get(S.value),k.permissions()]);p.value=l.data.data,u.value=e.data.data,t.value={name:p.value.name,slug:p.value.slug,permissions:(p.value.permissions||[]).map(o=>o.id)}}catch{C.error("Failed to load role data."),w.push({name:"roles.index"})}y.value=!1}async function L(){v.value=!0,g.value="";try{await k.update(S.value,{name:t.value.name,slug:t.value.slug,permissions:t.value.permissions}),C.success("Role updated successfully!"),w.push({name:"roles.index"})}catch(l){const e=l.response?.data?.errors;g.value=e?Object.values(e).flat()[0]:"Failed to update role."}finally{v.value=!1}}return U(()=>I()),(l,e)=>{const o=A("router-link");return r(),i("div",W,[s("div",X,[R(o,{to:{name:"roles.index"},class:"text-sm text-gray-500 hover:text-primary-600 mb-1 inline-block"},{default:b(()=>[...e[3]||(e[3]=[f("â† Back to Roles",-1)])]),_:1}),e[4]||(e[4]=s("h1",{class:"page-title"},"Edit Role",-1))]),y.value?(r(),V(K,{key:0,"full-page":""})):(r(),i(x,{key:1},[p.value?.is_system?(r(),V(Q,{key:0,type:"warning",class:"mb-6"},{default:b(()=>[...e[5]||(e[5]=[f(" This is a system role. Changes may affect core application functionality. Proceed with caution. ",-1)])]),_:1})):h("",!0),s("div",Y,[s("div",Z,[s("form",{onSubmit:z(L,["prevent"]),class:"space-y-6"},[g.value?(r(),i("div",ee,m(g.value),1)):h("",!0),s("div",se,[s("div",null,[e[6]||(e[6]=s("label",{class:"label-text"},"Role Name *",-1)),_(s("input",{"onUpdate:modelValue":e[0]||(e[0]=n=>t.value.name=n),onInput:E,type:"text",required:"",class:"input-field",placeholder:"e.g. Content Manager"},null,544),[[M,t.value.name]])]),s("div",null,[e[7]||(e[7]=s("label",{class:"label-text"},"Slug *",-1)),_(s("input",{"onUpdate:modelValue":e[1]||(e[1]=n=>t.value.slug=n),type:"text",required:"",class:"input-field",placeholder:"e.g. content-manager"},null,512),[[M,t.value.slug]])])]),s("div",null,[e[8]||(e[8]=s("label",{class:"label-text mb-3"},"Permissions",-1)),s("div",te,[(r(!0),i(x,null,B(u.value,(n,a)=>(r(),i("div",{key:a,class:"border border-gray-200 rounded-lg p-4"},[s("div",ae,[s("input",{type:"checkbox",id:`group-${a}`,checked:G(a),indeterminate:$(a),onChange:d=>D(a,d.target.checked),class:"h-4 w-4 text-primary-600 rounded border-gray-300 focus:ring-primary-500"},null,40,le),s("label",{for:`group-${a}`,class:"text-sm font-semibold text-gray-700 capitalize"},m(a),9,oe),s("span",ne," ("+m(q(a))+"/"+m(n.length)+") ",1)]),s("div",re,[(r(!0),i(x,null,B(n,d=>(r(),i("label",{key:d.id,class:"flex items-center gap-2 text-sm text-gray-600 cursor-pointer"},[_(s("input",{type:"checkbox",value:d.id,"onUpdate:modelValue":e[2]||(e[2]=T=>t.value.permissions=T),class:"h-4 w-4 text-primary-600 rounded border-gray-300 focus:ring-primary-500"},null,8,ie),[[H,t.value.permissions]]),f(" "+m(d.name),1)]))),128))])]))),128))]),Object.keys(u.value).length?h("",!0):(r(),i("p",ue,"No permissions available."))]),s("div",de,[R(o,{to:{name:"roles.index"},class:"btn-secondary"},{default:b(()=>[...e[9]||(e[9]=[f("Cancel",-1)])]),_:1}),s("button",{type:"submit",disabled:v.value,class:"btn-primary"},m(v.value?"Saving...":"Save Changes"),9,ce)])],32)])])],64))])}}};export{xe as default};
