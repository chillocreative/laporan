import{o as W,c as r,a as s,b,s as f,g as o,d as m,e as P,v as X,E as M,F as j,q as L,f as B,h as g,t as i,i as Y,r as n,G as I,k as l}from"./app-C4KUgVyX.js";import{u as Z}from"./useAuth-CYffRTTp.js";import{u as $}from"./users-Dk1UV6wj.js";import{r as ee}from"./roles-vqMtgHoS.js";import{f as te}from"./formatters-mqXhrHnm.js";import{_ as se}from"./DataTable-Cf95o7My.js";import{_ as F}from"./Badge-kHOsy9ee.js";import{_ as ae}from"./Pagination-C5qF7EKH.js";import{_ as le}from"./ConfirmDialog-Bd4D29IY.js";import{_ as oe}from"./Alert-COQRhmAu.js";/* empty css            */import"./LoadingSpinner-BnFVoTYS.js";const ne={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6 gap-4"},re={class:"card mb-6"},ie={class:"card-body"},ue={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"},de=["value"],ce={class:"card"},ve={class:"font-medium text-gray-900"},pe={class:"flex flex-wrap gap-1"},me={class:"text-xs text-gray-500"},ge={class:"flex items-center gap-2 justify-end"},fe=["onClick"],ye=["onClick","title"],_e=["onClick"],ke={class:"px-4 border-t border-gray-100"},xe={key:1,class:"fixed inset-0 z-50 flex items-center justify-center p-4"},be={class:"relative bg-white rounded-xl shadow-xl w-full max-w-md p-6"},he={class:"text-sm text-gray-600 mb-4"},we=["value"],Ae={class:"flex justify-end gap-3"},Ce=["disabled"],Ee={__name:"UserList",setup(Pe){const h=Z(),N=n([]),U=n([]),T=n(!0),u=I({currentPage:1,lastPage:1,total:0}),d=I({search:"",role:"",is_active:""}),w=n(""),S=n("success"),A=n(!1),y=n(null),_=n(!1),D=n(null),k=n(""),C=n(!1);function V(a){return!a.is_active&&(!a.roles||a.roles.length===0)}function R(a){D.value=a,k.value="",_.value=!0}async function z(){C.value=!0;try{const{data:a}=await $.approve(D.value.id,{role_id:k.value});v("success",a.message),_.value=!1,c(u.currentPage)}catch(a){v("error",a.response?.data?.message||"Failed to approve user.")}C.value=!1}let E;const q=()=>{clearTimeout(E),E=setTimeout(c,400)},G=[{key:"name",label:"Name"},{key:"email",label:"Email"},{key:"roles",label:"Roles"},{key:"is_active",label:"Status"},{key:"created_at",label:"Created"}];async function c(a=1){T.value=!0;try{const e={...d,page:a,per_page:15};Object.keys(e).forEach(t=>{!e[t]&&e[t]!==0&&delete e[t]});const{data:p}=await $.list(e);N.value=p.data,u.currentPage=p.meta?.current_page||1,u.lastPage=p.meta?.last_page||1,u.total=p.meta?.total||0}catch{v("error","Failed to load users.")}T.value=!1}async function H(){try{const{data:a}=await ee.assignable();U.value=a.data}catch{}}function O(a){c(a)}async function J(a){try{await $.toggleActive(a.id),a.is_active=!a.is_active,v("success",`User '${a.name}' has been ${a.is_active?"activated":"deactivated"}.`)}catch{v("error","Failed to update user status.")}}function K(a){y.value=a,A.value=!0}async function Q(){A.value=!1;try{await $.delete(y.value.id),v("success",`User '${y.value.name}' has been deleted.`),c(u.currentPage)}catch{v("error","Failed to delete user.")}y.value=null}function v(a,e){S.value=a,w.value=e,setTimeout(()=>{w.value=""},4e3)}return W(()=>{c(),H()}),(a,e)=>{const p=Y("router-link");return l(),r("div",null,[s("div",ne,[e[8]||(e[8]=s("div",null,[s("h1",{class:"page-title"},"Users"),s("p",{class:"page-subtitle"},"Manage user accounts and roles")],-1)),b(h).hasPermission("users.create")?(l(),f(p,{key:0,to:{name:"users.create"},class:"btn-primary"},{default:o(()=>[...e[7]||(e[7]=[g(" + New User ",-1)])]),_:1})):m("",!0)]),w.value?(l(),f(oe,{key:0,type:S.value,class:"mb-4"},{default:o(()=>[g(i(w.value),1)]),_:1},8,["type"])):m("",!0),s("div",re,[s("div",ie,[s("div",ue,[P(s("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>d.search=t),onInput:q,type:"text",placeholder:"Search by name or email...",class:"input-field"},null,544),[[X,d.search]]),P(s("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>d.role=t),onChange:c,class:"input-field"},[e[9]||(e[9]=s("option",{value:""},"All Roles",-1)),(l(!0),r(j,null,L(U.value,t=>(l(),r("option",{key:t.id,value:t.slug},i(t.name),9,de))),128))],544),[[M,d.role]]),P(s("select",{"onUpdate:modelValue":e[2]||(e[2]=t=>d.is_active=t),onChange:c,class:"input-field"},[...e[10]||(e[10]=[s("option",{value:""},"All Statuses",-1),s("option",{value:"1"},"Active",-1),s("option",{value:"0"},"Inactive",-1)])],544),[[M,d.is_active]])])])]),s("div",ce,[B(se,{columns:G,items:N.value,loading:T.value},{"cell-name":o(({item:t})=>[s("span",ve,i(t.name),1)]),"cell-roles":o(({item:t})=>[s("div",pe,[(l(!0),r(j,null,L(t.roles,x=>(l(),f(F,{key:x.id,color:"indigo"},{default:o(()=>[g(i(x.name),1)]),_:2},1024))),128))])]),"cell-is_active":o(({item:t})=>[V(t)?(l(),f(F,{key:0,color:"yellow"},{default:o(()=>[...e[11]||(e[11]=[g("Pending",-1)])]),_:1})):(l(),f(F,{key:1,color:t.is_active?"green":"red"},{default:o(()=>[g(i(t.is_active?"Active":"Inactive"),1)]),_:2},1032,["color"]))]),"cell-created_at":o(({item:t})=>[s("span",me,i(b(te)(t.created_at)),1)]),actions:o(({item:t})=>[s("div",ge,[V(t)?(l(),r("button",{key:0,onClick:x=>R(t),class:"text-xs bg-green-600 hover:bg-green-700 text-white px-2.5 py-1 rounded-md font-medium",title:"Approve"}," Approve ",8,fe)):m("",!0),b(h).hasPermission("users.edit")?(l(),f(p,{key:1,to:{name:"users.edit",params:{id:t.id}},class:"text-gray-400 hover:text-primary-600",title:"Edit"},{default:o(()=>[...e[12]||(e[12]=[s("svg",{class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125"})],-1)])]),_:1},8,["to"])):m("",!0),b(h).hasPermission("users.edit")&&!V(t)?(l(),r("button",{key:2,onClick:x=>J(t),class:"text-gray-400 hover:text-yellow-600",title:t.is_active?"Deactivate":"Activate"},[...e[13]||(e[13]=[s("svg",{class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5.636 5.636a9 9 0 1012.728 0M12 3v9"})],-1)])],8,ye)):m("",!0),b(h).hasPermission("users.delete")?(l(),r("button",{key:3,onClick:x=>K(t),class:"text-gray-400 hover:text-red-600",title:"Delete"},[...e[14]||(e[14]=[s("svg",{class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"})],-1)])],8,_e)):m("",!0)])]),_:1},8,["items","loading"]),s("div",ke,[B(ae,{"current-page":u.currentPage,"last-page":u.lastPage,total:u.total,onPageChange:O},null,8,["current-page","last-page","total"])])]),_.value?(l(),r("div",xe,[s("div",{class:"fixed inset-0 bg-black/50",onClick:e[3]||(e[3]=t=>_.value=!1)}),s("div",be,[e[18]||(e[18]=s("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Approve User",-1)),s("p",he,[e[15]||(e[15]=g("Approve ",-1)),s("strong",null,i(D.value?.name),1),e[16]||(e[16]=g(" and assign a role:",-1))]),P(s("select",{"onUpdate:modelValue":e[4]||(e[4]=t=>k.value=t),class:"input-field mb-4"},[e[17]||(e[17]=s("option",{value:""},"Select role",-1)),(l(!0),r(j,null,L(U.value,t=>(l(),r("option",{key:t.id,value:t.id},i(t.name),9,we))),128))],512),[[M,k.value]]),s("div",Ae,[s("button",{onClick:e[5]||(e[5]=t=>_.value=!1),class:"btn-secondary"},"Cancel"),s("button",{onClick:z,disabled:!k.value||C.value,class:"btn-primary"},i(C.value?"Approving...":"Approve"),9,Ce)])])])):m("",!0),B(le,{modelValue:A.value,"onUpdate:modelValue":e[6]||(e[6]=t=>A.value=t),title:"Delete User",message:`Are you sure you want to delete '${y.value?.name}'? This action cannot be undone.`,"confirm-text":"Delete",danger:!0,onConfirm:Q},null,8,["modelValue","message"])])}}};export{Ee as default};
