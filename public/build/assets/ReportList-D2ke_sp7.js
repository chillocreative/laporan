import{o as j,c as o,a as s,b as m,s as R,g as i,d as x,e as g,v as B,E as _,F as f,q as y,f as k,r as v,i as E,G as T,k as a,h as b,t as u}from"./app-UaHG2GIC.js";import{u as L}from"./useAuth-QBQXqBYk.js";import{r as S}from"./reports-DDhWITM5.js";import{c as D}from"./categories-B6N2PC3B.js";import{u as O}from"./users-DZeu5oDX.js";import{r as F}from"./roles-4r3X_wq3.js";import{R as $}from"./constants-CkKKVJMd.js";import{f as z}from"./formatters-mqXhrHnm.js";import{_ as I}from"./DataTable-D6r3aRVp.js";import{_ as q}from"./Badge-DAhmnd02.js";import{_ as G}from"./Pagination-D0576I20.js";/* empty css            */import"./LoadingSpinner-BRfTtkMt.js";const K={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6 gap-4"},H={class:"card mb-6"},J={class:"card-body"},Q={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4"},W=["value"],X=["value"],Y=["value"],Z=["value"],ee={class:"card"},te={class:"text-sm text-gray-700"},se={key:1,class:"text-xs text-gray-400"},ae={class:"text-xs text-gray-500"},oe={class:"flex items-center gap-2 justify-end"},le={class:"px-4 border-t border-gray-100"},he={__name:"ReportList",setup(re){const c=L(),w=v([]),P=v([]),C=v([]),A=v([]),h=v(!0),p=T({currentPage:1,lastPage:1,total:0}),l=T({search:"",category:"",risk_level:"",user_id:"",role:""});let V;const U=()=>{clearTimeout(V),V=setTimeout(d,400)},M=[{key:"title",label:"Title"},{key:"category",label:"Category"},{key:"user",label:"User"},{key:"ai_analysis",label:"Risk"},{key:"incident_date",label:"Date"}];async function d(r=1){h.value=!0;try{const t={...l,page:r,per_page:15};Object.keys(t).forEach(e=>{t[e]||delete t[e]});const{data:n}=await S.list(t);A.value=n.data,p.currentPage=n.meta?.current_page||1,p.lastPage=n.meta?.last_page||1,p.total=n.meta?.total||0}catch{}h.value=!1}function N(r){d(r)}return j(()=>{d(),D.active().then(({data:r})=>{w.value=r.data}).catch(()=>{}),c.hasPermission("users.view")&&O.list({per_page:1e3}).then(({data:r})=>{P.value=r.data}).catch(()=>{}),c.hasPermission("roles.view")&&F.list({per_page:100}).then(({data:r})=>{C.value=r.data}).catch(()=>{})}),(r,t)=>{const n=E("router-link");return a(),o("div",null,[s("div",K,[t[6]||(t[6]=s("div",null,[s("h1",{class:"page-title"},"Reports"),s("p",{class:"page-subtitle"},"Manage and track all reports")],-1)),m(c).hasPermission("reports.create")?(a(),R(n,{key:0,to:{name:"reports.create"},class:"btn-primary"},{default:i(()=>[...t[5]||(t[5]=[b(" + New Report ",-1)])]),_:1})):x("",!0)]),s("div",H,[s("div",J,[s("div",Q,[g(s("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>l.search=e),onInput:U,type:"text",placeholder:"Search reports...",class:"input-field"},null,544),[[B,l.search]]),g(s("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>l.category=e),onChange:d,class:"input-field"},[t[7]||(t[7]=s("option",{value:""},"All Categories",-1)),(a(!0),o(f,null,y(w.value,e=>(a(),o("option",{key:e,value:e},u(e),9,W))),128))],544),[[_,l.category]]),g(s("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>l.risk_level=e),onChange:d,class:"input-field"},[t[8]||(t[8]=s("option",{value:""},"All Risk Levels",-1)),(a(!0),o(f,null,y(m($),e=>(a(),o("option",{key:e.value,value:e.value},u(e.label),9,X))),128))],544),[[_,l.risk_level]]),m(c).hasPermission("users.view")?g((a(),o("select",{key:0,"onUpdate:modelValue":t[3]||(t[3]=e=>l.user_id=e),onChange:d,class:"input-field"},[t[9]||(t[9]=s("option",{value:""},"All Users",-1)),(a(!0),o(f,null,y(P.value,e=>(a(),o("option",{key:e.id,value:e.id},u(e.name),9,Y))),128))],544)),[[_,l.user_id]]):x("",!0),m(c).hasPermission("roles.view")?g((a(),o("select",{key:1,"onUpdate:modelValue":t[4]||(t[4]=e=>l.role=e),onChange:d,class:"input-field"},[t[10]||(t[10]=s("option",{value:""},"All Roles",-1)),(a(!0),o(f,null,y(C.value,e=>(a(),o("option",{key:e.id,value:e.name},u(e.name),9,Z))),128))],544)),[[_,l.role]]):x("",!0)])])]),s("div",ee,[k(I,{columns:M,items:A.value,loading:h.value},{"cell-title":i(({item:e})=>[k(n,{to:{name:"reports.show",params:{id:e.id}},class:"font-medium text-primary-600 hover:text-primary-800"},{default:i(()=>[b(u(e.title),1)]),_:2},1032,["to"])]),"cell-user":i(({item:e})=>[s("span",te,u(e.user?.name||"N/A"),1)]),"cell-ai_analysis":i(({item:e})=>[e.ai_analysis?(a(),R(q,{key:0,color:e.ai_analysis.risk_level?.color},{default:i(()=>[b(u(e.ai_analysis.risk_level?.label),1)]),_:2},1032,["color"])):(a(),o("span",se,"Pending"))]),"cell-incident_date":i(({item:e})=>[s("span",ae,u(m(z)(e.incident_date)),1)]),actions:i(({item:e})=>[s("div",oe,[k(n,{to:{name:"reports.show",params:{id:e.id}},class:"text-gray-400 hover:text-primary-600"},{default:i(()=>[...t[11]||(t[11]=[s("svg",{class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z"}),s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})],-1)])]),_:1},8,["to"])])]),_:1},8,["items","loading"]),s("div",le,[k(G,{"current-page":p.currentPage,"last-page":p.lastPage,total:p.total,onPageChange:N},null,8,["current-page","last-page","total"])])])])}}};export{he as default};
