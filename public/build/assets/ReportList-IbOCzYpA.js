import{o as B,c as l,a as s,b as m,s as V,g as i,d as x,e as g,v as E,E as _,F as f,q as y,f as k,r as v,i as L,G as T,y as O,k as a,h as b,t as u}from"./app-CkgA-AoW.js";import{u as S}from"./useAuth-DjetSSvL.js";import{r as D}from"./reports-C3DfIrAh.js";import{c as F}from"./categories-B6X8XmyS.js";import{u as $}from"./users-Pj1-Xddz.js";import{r as z}from"./roles-BZvqwXPl.js";import{R as I}from"./constants-CkKKVJMd.js";import{f as q}from"./formatters-mqXhrHnm.js";import{_ as G}from"./DataTable-CRY2krIF.js";import{_ as K}from"./Badge-DmpLveg_.js";import{_ as H}from"./Pagination-CBmx2ga-.js";/* empty css            */import"./LoadingSpinner-B-34TY8e.js";const J={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6 gap-4"},Q={class:"card mb-6"},W={class:"card-body"},X={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4"},Y=["value"],Z=["value"],ee=["value"],te=["value"],se={class:"card"},ae={class:"text-sm text-gray-700"},oe={key:1,class:"text-xs text-gray-400"},le={class:"text-xs text-gray-500"},re={class:"flex items-center gap-2 justify-end"},ie={class:"px-4 border-t border-gray-100"},be={__name:"ReportList",setup(ne){const d=S(),w=v([]),P=v([]),C=v([]),A=v([]),h=v(!0),c=T({currentPage:1,lastPage:1,total:0}),r=T({search:"",category:"",risk_level:"",user_id:"",role:""}),U=O(()=>C.value.filter(o=>!["super-admin","admin"].includes(o.slug)));let R;const M=()=>{clearTimeout(R),R=setTimeout(p,400)},N=[{key:"title",label:"Title"},{key:"category",label:"Category"},{key:"user",label:"User"},{key:"ai_analysis",label:"Risk"},{key:"incident_date",label:"Date"}];async function p(o=1){h.value=!0;try{const t={...r,page:o,per_page:15};Object.keys(t).forEach(e=>{t[e]||delete t[e]});const{data:n}=await D.list(t);A.value=n.data,c.currentPage=n.meta?.current_page||1,c.lastPage=n.meta?.last_page||1,c.total=n.meta?.total||0}catch{}h.value=!1}function j(o){p(o)}return B(()=>{p(),F.active().then(({data:o})=>{w.value=o.data}).catch(()=>{}),d.hasPermission("users.view")&&$.list({per_page:1e3}).then(({data:o})=>{P.value=o.data}).catch(()=>{}),(d.hasPermission("users.view")||d.hasPermission("roles.view"))&&z.list({per_page:100}).then(({data:o})=>{C.value=o.data}).catch(()=>{})}),(o,t)=>{const n=L("router-link");return a(),l("div",null,[s("div",J,[t[6]||(t[6]=s("div",null,[s("h1",{class:"page-title"},"Reports"),s("p",{class:"page-subtitle"},"Manage and track all reports")],-1)),m(d).hasPermission("reports.create")?(a(),V(n,{key:0,to:{name:"reports.create"},class:"btn-primary"},{default:i(()=>[...t[5]||(t[5]=[b(" + New Report ",-1)])]),_:1})):x("",!0)]),s("div",Q,[s("div",W,[s("div",X,[g(s("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>r.search=e),onInput:M,type:"text",placeholder:"Search reports...",class:"input-field"},null,544),[[E,r.search]]),g(s("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>r.category=e),onChange:p,class:"input-field"},[t[7]||(t[7]=s("option",{value:""},"All Categories",-1)),(a(!0),l(f,null,y(w.value,e=>(a(),l("option",{key:e,value:e},u(e),9,Y))),128))],544),[[_,r.category]]),g(s("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>r.risk_level=e),onChange:p,class:"input-field"},[t[8]||(t[8]=s("option",{value:""},"All Risk Levels",-1)),(a(!0),l(f,null,y(m(I),e=>(a(),l("option",{key:e.value,value:e.value},u(e.label),9,Z))),128))],544),[[_,r.risk_level]]),m(d).hasPermission("users.view")?g((a(),l("select",{key:0,"onUpdate:modelValue":t[3]||(t[3]=e=>r.user_id=e),onChange:p,class:"input-field"},[t[9]||(t[9]=s("option",{value:""},"All Users",-1)),(a(!0),l(f,null,y(P.value,e=>(a(),l("option",{key:e.id,value:e.id},u(e.name),9,ee))),128))],544)),[[_,r.user_id]]):x("",!0),m(d).hasPermission("users.view")||m(d).hasPermission("roles.view")?g((a(),l("select",{key:1,"onUpdate:modelValue":t[4]||(t[4]=e=>r.role=e),onChange:p,class:"input-field"},[t[10]||(t[10]=s("option",{value:""},"All Roles",-1)),(a(!0),l(f,null,y(U.value,e=>(a(),l("option",{key:e.id,value:e.name},u(e.name),9,te))),128))],544)),[[_,r.role]]):x("",!0)])])]),s("div",se,[k(G,{columns:N,items:A.value,loading:h.value},{"cell-title":i(({item:e})=>[k(n,{to:{name:"reports.show",params:{id:e.id}},class:"font-medium text-primary-600 hover:text-primary-800"},{default:i(()=>[b(u(e.title),1)]),_:2},1032,["to"])]),"cell-user":i(({item:e})=>[s("span",ae,u(e.user?.name||"N/A"),1)]),"cell-ai_analysis":i(({item:e})=>[e.ai_analysis?(a(),V(K,{key:0,color:e.ai_analysis.risk_level?.color},{default:i(()=>[b(u(e.ai_analysis.risk_level?.label),1)]),_:2},1032,["color"])):(a(),l("span",oe,"Pending"))]),"cell-incident_date":i(({item:e})=>[s("span",le,u(m(q)(e.incident_date)),1)]),actions:i(({item:e})=>[s("div",re,[k(n,{to:{name:"reports.show",params:{id:e.id}},class:"text-gray-400 hover:text-primary-600"},{default:i(()=>[...t[11]||(t[11]=[s("svg",{class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z"}),s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})],-1)])]),_:1},8,["to"])])]),_:1},8,["items","loading"]),s("div",ie,[k(H,{"current-page":c.currentPage,"last-page":c.lastPage,total:c.total,onPageChange:j},null,8,["current-page","last-page","total"])])])])}}};export{be as default};
