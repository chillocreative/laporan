import{o as W,c as i,a,b as h,s as f,g as n,d as p,e as A,v as X,E as D,F as B,q as j,f as U,h as g,t as r,i as Y,r as o,G as F,k as l}from"./app-CQob2CXV.js";import{u as Z}from"./useAuth-DYlSfytT.js";import{u as T}from"./users-C-5nBVbu.js";import{r as ee}from"./roles-Db10dzzm.js";import{f as te}from"./formatters-mqXhrHnm.js";import{_ as ae}from"./DataTable-CBHjvgis.js";import{_ as S}from"./Badge-z3vH81Ng.js";import{_ as se}from"./Pagination-DJfjs7f7.js";import{_ as le}from"./ConfirmDialog-DreKFstW.js";import{_ as ne}from"./Alert-BBtW9gVx.js";/* empty css            */import"./LoadingSpinner-C2gbwHS5.js";const oe={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6 gap-4"},ie={class:"card mb-6"},re={class:"card-body"},ue={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"},de=["value"],ce={class:"card"},me={class:"font-medium text-gray-900"},ve={class:"flex flex-wrap gap-1"},pe={class:"text-xs text-gray-500"},ge={class:"flex items-center gap-2 justify-end"},fe=["onClick"],ke=["onClick","title"],ye=["onClick"],_e={class:"px-4 border-t border-gray-100"},xe={key:1,class:"fixed inset-0 z-50 flex items-center justify-center p-4"},he={class:"relative bg-white rounded-xl shadow-xl w-full max-w-md p-6"},be={class:"text-sm text-gray-600 mb-4"},we=["value"],Pe={class:"flex justify-end gap-3"},Ce=["disabled"],Ne={__name:"UserList",setup(Ae){const b=Z(),E=o([]),$=o([]),L=o(!0),u=F({currentPage:1,lastPage:1,total:0}),d=F({search:"",role:"",is_active:""}),w=o(""),G=o("success"),P=o(!1),k=o(null),y=o(!1),M=o(null),_=o(""),C=o(!1);function V(s){return!s.is_active&&(!s.roles||s.roles.length===0)}function z(s){M.value=s,_.value="",y.value=!0}async function I(){C.value=!0;try{const{data:s}=await T.approve(M.value.id,{role_id:_.value});m("success",s.message),y.value=!1,c(u.currentPage)}catch(s){m("error",s.response?.data?.message||"Gagal meluluskan pengguna.")}C.value=!1}let N;const R=()=>{clearTimeout(N),N=setTimeout(c,400)},q=[{key:"name",label:"Nama"},{key:"email",label:"E-mel"},{key:"roles",label:"Peranan"},{key:"is_active",label:"Status"},{key:"created_at",label:"Dicipta"}];async function c(s=1){L.value=!0;try{const e={...d,page:s,per_page:15};Object.keys(e).forEach(t=>{!e[t]&&e[t]!==0&&delete e[t]});const{data:v}=await T.list(e);E.value=v.data,u.currentPage=v.meta?.current_page||1,u.lastPage=v.meta?.last_page||1,u.total=v.meta?.total||0}catch{m("error","Gagal memuatkan pengguna.")}L.value=!1}async function H(){try{const{data:s}=await ee.assignable();$.value=s.data}catch{}}function O(s){c(s)}async function J(s){try{await T.toggleActive(s.id),s.is_active=!s.is_active,m("success",`Pengguna '${s.name}' telah ${s.is_active?"diaktifkan":"dinyahaktifkan"}.`)}catch{m("error","Gagal mengemas kini status pengguna.")}}function K(s){k.value=s,P.value=!0}async function Q(){P.value=!1;try{await T.delete(k.value.id),m("success",`Pengguna '${k.value.name}' telah dipadam.`),c(u.currentPage)}catch{m("error","Gagal memadam pengguna.")}k.value=null}function m(s,e){G.value=s,w.value=e,setTimeout(()=>{w.value=""},4e3)}return W(()=>{c(),H()}),(s,e)=>{const v=Y("router-link");return l(),i("div",null,[a("div",oe,[e[8]||(e[8]=a("div",null,[a("h1",{class:"page-title"},"Pengguna"),a("p",{class:"page-subtitle"},"Urus akaun pengguna dan peranan")],-1)),h(b).hasPermission("users.create")?(l(),f(v,{key:0,to:{name:"users.create"},class:"btn-primary"},{default:n(()=>[...e[7]||(e[7]=[g(" + Pengguna Baru ",-1)])]),_:1})):p("",!0)]),w.value?(l(),f(ne,{key:0,type:G.value,class:"mb-4"},{default:n(()=>[g(r(w.value),1)]),_:1},8,["type"])):p("",!0),a("div",ie,[a("div",re,[a("div",ue,[A(a("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>d.search=t),onInput:R,type:"text",placeholder:"Cari mengikut nama atau e-mel...",class:"input-field"},null,544),[[X,d.search]]),A(a("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>d.role=t),onChange:c,class:"input-field"},[e[9]||(e[9]=a("option",{value:""},"Semua Peranan",-1)),(l(!0),i(B,null,j($.value,t=>(l(),i("option",{key:t.id,value:t.slug},r(t.name),9,de))),128))],544),[[D,d.role]]),A(a("select",{"onUpdate:modelValue":e[2]||(e[2]=t=>d.is_active=t),onChange:c,class:"input-field"},[...e[10]||(e[10]=[a("option",{value:""},"Semua Status",-1),a("option",{value:"1"},"Aktif",-1),a("option",{value:"0"},"Tidak Aktif",-1)])],544),[[D,d.is_active]])])])]),a("div",ce,[U(ae,{columns:q,items:E.value,loading:L.value},{"cell-name":n(({item:t})=>[a("span",me,r(t.name),1)]),"cell-roles":n(({item:t})=>[a("div",ve,[(l(!0),i(B,null,j(t.roles,x=>(l(),f(S,{key:x.id,color:"indigo"},{default:n(()=>[g(r(x.name),1)]),_:2},1024))),128))])]),"cell-is_active":n(({item:t})=>[V(t)?(l(),f(S,{key:0,color:"yellow"},{default:n(()=>[...e[11]||(e[11]=[g("Menunggu",-1)])]),_:1})):(l(),f(S,{key:1,color:t.is_active?"green":"red"},{default:n(()=>[g(r(t.is_active?"Aktif":"Tidak Aktif"),1)]),_:2},1032,["color"]))]),"cell-created_at":n(({item:t})=>[a("span",pe,r(h(te)(t.created_at)),1)]),actions:n(({item:t})=>[a("div",ge,[V(t)?(l(),i("button",{key:0,onClick:x=>z(t),class:"text-xs bg-green-600 hover:bg-green-700 text-white px-2.5 py-1 rounded-md font-medium",title:"Luluskan"}," Luluskan ",8,fe)):p("",!0),h(b).hasPermission("users.edit")?(l(),f(v,{key:1,to:{name:"users.edit",params:{id:t.id}},class:"text-gray-400 hover:text-primary-600",title:"Edit"},{default:n(()=>[...e[12]||(e[12]=[a("svg",{class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125"})],-1)])]),_:1},8,["to"])):p("",!0),h(b).hasPermission("users.edit")&&!V(t)?(l(),i("button",{key:2,onClick:x=>J(t),class:"text-gray-400 hover:text-yellow-600",title:t.is_active?"Deactivate":"Activate"},[...e[13]||(e[13]=[a("svg",{class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5.636 5.636a9 9 0 1012.728 0M12 3v9"})],-1)])],8,ke)):p("",!0),h(b).hasPermission("users.delete")?(l(),i("button",{key:3,onClick:x=>K(t),class:"text-gray-400 hover:text-red-600",title:"Delete"},[...e[14]||(e[14]=[a("svg",{class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"})],-1)])],8,ye)):p("",!0)])]),_:1},8,["items","loading"]),a("div",_e,[U(se,{"current-page":u.currentPage,"last-page":u.lastPage,total:u.total,onPageChange:O},null,8,["current-page","last-page","total"])])]),y.value?(l(),i("div",xe,[a("div",{class:"fixed inset-0 bg-black/50",onClick:e[3]||(e[3]=t=>y.value=!1)}),a("div",he,[e[18]||(e[18]=a("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Luluskan Pengguna",-1)),a("p",be,[e[15]||(e[15]=g("Luluskan ",-1)),a("strong",null,r(M.value?.name),1),e[16]||(e[16]=g(" dan tetapkan peranan:",-1))]),A(a("select",{"onUpdate:modelValue":e[4]||(e[4]=t=>_.value=t),class:"input-field mb-4"},[e[17]||(e[17]=a("option",{value:""},"Pilih peranan",-1)),(l(!0),i(B,null,j($.value,t=>(l(),i("option",{key:t.id,value:t.id},r(t.name),9,we))),128))],512),[[D,_.value]]),a("div",Pe,[a("button",{onClick:e[5]||(e[5]=t=>y.value=!1),class:"btn-secondary"},"Batal"),a("button",{onClick:I,disabled:!_.value||C.value,class:"btn-primary"},r(C.value?"Meluluskan...":"Luluskan"),9,Ce)])])])):p("",!0),U(le,{modelValue:P.value,"onUpdate:modelValue":e[6]||(e[6]=t=>P.value=t),title:"Padam Pengguna",message:`Adakah anda pasti mahu memadam '${k.value?.name}'? Tindakan ini tidak boleh dibatalkan.`,"confirm-text":"Padam",danger:!0,onConfirm:Q},null,8,["modelValue","message"])])}}};export{Ne as default};
