import{o as N,c as r,a,b as k,s as P,g as n,d as j,e as c,v as B,E as g,F as v,q as _,f,r as m,i as E,G as V,k as s,h,t as d}from"./app-ClAtGGNd.js";import{u as L}from"./useAuth-L8iQPwP8.js";import{r as S}from"./reports-CiahG0Em.js";import{c as D}from"./categories-2OI9ya0D.js";import{u as O}from"./users-LJHkvb_G.js";import{r as F}from"./roles-BQuX2EsU.js";import{R as $}from"./constants-CkKKVJMd.js";import{f as z}from"./formatters-mqXhrHnm.js";import{_ as I}from"./DataTable-CDWY0LL_.js";import{_ as q}from"./Badge-DGfltuxN.js";import{_ as G}from"./Pagination-BDGCprb3.js";/* empty css            */import"./LoadingSpinner-Cx3ytnbN.js";const K={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6 gap-4"},H={class:"card mb-6"},J={class:"card-body"},Q={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4"},W=["value"],X=["value"],Y=["value"],Z=["value"],ee={class:"card"},te={class:"text-sm text-gray-700"},ae={key:1,class:"text-xs text-gray-400"},se={class:"text-xs text-gray-500"},oe={class:"flex items-center gap-2 justify-end"},le={class:"px-4 border-t border-gray-100"},he={__name:"ReportList",setup(re){const R=L(),x=m([]),b=m([]),C=m([]),w=m([]),y=m(!0),p=V({currentPage:1,lastPage:1,total:0}),o=V({search:"",category:"",risk_level:"",user_id:"",role:""});let A;const T=()=>{clearTimeout(A),A=setTimeout(u,400)},U=[{key:"title",label:"Title"},{key:"category",label:"Category"},{key:"user",label:"User"},{key:"ai_analysis",label:"Risk"},{key:"incident_date",label:"Date"}];async function u(l=1){y.value=!0;try{const t={...o,page:l,per_page:15};Object.keys(t).forEach(e=>{t[e]||delete t[e]});const{data:i}=await S.list(t);w.value=i.data,p.currentPage=i.meta?.current_page||1,p.lastPage=i.meta?.last_page||1,p.total=i.meta?.total||0}catch{}y.value=!1}function M(l){u(l)}return N(()=>{u(),D.active().then(({data:l})=>{x.value=l.data}).catch(()=>{}),O.list({per_page:1e3}).then(({data:l})=>{b.value=l.data}).catch(()=>{}),F.list({per_page:100}).then(({data:l})=>{C.value=l.data}).catch(()=>{})}),(l,t)=>{const i=E("router-link");return s(),r("div",null,[a("div",K,[t[6]||(t[6]=a("div",null,[a("h1",{class:"page-title"},"Reports"),a("p",{class:"page-subtitle"},"Manage and track all reports")],-1)),k(R).hasPermission("reports.create")?(s(),P(i,{key:0,to:{name:"reports.create"},class:"btn-primary"},{default:n(()=>[...t[5]||(t[5]=[h(" + New Report ",-1)])]),_:1})):j("",!0)]),a("div",H,[a("div",J,[a("div",Q,[c(a("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>o.search=e),onInput:T,type:"text",placeholder:"Search reports...",class:"input-field"},null,544),[[B,o.search]]),c(a("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>o.category=e),onChange:u,class:"input-field"},[t[7]||(t[7]=a("option",{value:""},"All Categories",-1)),(s(!0),r(v,null,_(x.value,e=>(s(),r("option",{key:e,value:e},d(e),9,W))),128))],544),[[g,o.category]]),c(a("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>o.risk_level=e),onChange:u,class:"input-field"},[t[8]||(t[8]=a("option",{value:""},"All Risk Levels",-1)),(s(!0),r(v,null,_(k($),e=>(s(),r("option",{key:e.value,value:e.value},d(e.label),9,X))),128))],544),[[g,o.risk_level]]),c(a("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>o.user_id=e),onChange:u,class:"input-field"},[t[9]||(t[9]=a("option",{value:""},"All Users",-1)),(s(!0),r(v,null,_(b.value,e=>(s(),r("option",{key:e.id,value:e.id},d(e.name),9,Y))),128))],544),[[g,o.user_id]]),c(a("select",{"onUpdate:modelValue":t[4]||(t[4]=e=>o.role=e),onChange:u,class:"input-field"},[t[10]||(t[10]=a("option",{value:""},"All Roles",-1)),(s(!0),r(v,null,_(C.value,e=>(s(),r("option",{key:e.id,value:e.name},d(e.name),9,Z))),128))],544),[[g,o.role]])])])]),a("div",ee,[f(I,{columns:U,items:w.value,loading:y.value},{"cell-title":n(({item:e})=>[f(i,{to:{name:"reports.show",params:{id:e.id}},class:"font-medium text-primary-600 hover:text-primary-800"},{default:n(()=>[h(d(e.title),1)]),_:2},1032,["to"])]),"cell-user":n(({item:e})=>[a("span",te,d(e.user?.name||"N/A"),1)]),"cell-ai_analysis":n(({item:e})=>[e.ai_analysis?(s(),P(q,{key:0,color:e.ai_analysis.risk_level?.color},{default:n(()=>[h(d(e.ai_analysis.risk_level?.label),1)]),_:2},1032,["color"])):(s(),r("span",ae,"Pending"))]),"cell-incident_date":n(({item:e})=>[a("span",se,d(k(z)(e.incident_date)),1)]),actions:n(({item:e})=>[a("div",oe,[f(i,{to:{name:"reports.show",params:{id:e.id}},class:"text-gray-400 hover:text-primary-600"},{default:n(()=>[...t[11]||(t[11]=[a("svg",{class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z"}),a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})],-1)])]),_:1},8,["to"])])]),_:1},8,["items","loading"]),a("div",le,[f(G,{"current-page":p.currentPage,"last-page":p.lastPage,total:p.total,onPageChange:M},null,8,["current-page","last-page","total"])])])])}}};export{he as default};
