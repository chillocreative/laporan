import{o as R,c as n,s as L,F as M,a as s,f as _,g as x,t as a,d,q as N,b as c,r as v,i as z,y as f,j as S,n as $,k as i,h}from"./app-D7nogW7V.js";import{u as E}from"./useAuth-DmQGVAHB.js";import{u as K}from"./useNotification-D2PjxE6j.js";import{a as k}from"./formatters-mqXhrHnm.js";import{r as b}from"./reports-DOW6EZM5.js";import{_ as F}from"./Badge-CDjxviGu.js";import{_ as G}from"./LoadingSpinner-CUYk7edN.js";import{_ as H}from"./ConfirmDialog-DBWpgHUO.js";/* empty css            */import"./notifications-DUq4YrNs.js";const q={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6 gap-4"},U={class:"page-title"},J={class:"flex gap-2"},O={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},Q={class:"lg:col-span-2 space-y-6"},W={class:"card"},X={class:"card-body space-y-4"},Y={class:"grid grid-cols-2 gap-4 text-sm"},Z={class:"font-medium"},ss={class:"font-medium"},es=["innerHTML"],ts={key:0,class:"card"},as={class:"card-header"},is={class:"font-semibold text-gray-900"},ns={class:"card-body"},os={class:"divide-y divide-gray-100"},rs={class:"flex items-center gap-2 text-sm min-w-0"},ls={class:"truncate"},ds={class:"text-gray-400 flex-shrink-0"},us={class:"flex items-center gap-1 flex-shrink-0 ml-3"},cs=["href"],ms=["href"],ps={class:"card"},vs={class:"card-header flex items-center justify-between"},gs=["disabled"],ys={key:0,class:"card-body space-y-4"},_s={class:"grid grid-cols-2 gap-4"},xs={class:"text-center p-3 rounded-lg bg-gray-50"},fs={class:"text-center p-3 rounded-lg bg-gray-50"},hs={class:"text-lg font-bold text-gray-900"},ks={class:"text-sm text-gray-700"},bs={class:"text-sm text-gray-700"},ws={key:0},As={class:"text-sm text-gray-700"},Ls={class:"text-xs text-gray-400"},Ms={key:1,class:"card-body"},Cs={class:"text-sm text-gray-400 text-center py-4"},Ds={class:"space-y-6"},js={class:"card"},Bs={class:"card-body text-sm space-y-3"},Ps={class:"font-medium"},Vs={class:"font-medium"},Ts={class:"font-medium"},Hs={__name:"ReportShow",props:{id:[String,Number]},setup(C){const D=C,j=$(),w=S(),l=E(),u=K(),t=v(null),g=v(!0),m=v(!1),p=v(!1),y=f(()=>D.id||j.params.id),B=f(()=>t.value?l.hasPermission("reports.edit-any")?!0:l.hasPermission("reports.edit-own")&&t.value.user?.id===l.user.value?.id:!1),P=f(()=>t.value?l.hasPermission("reports.delete-any")?!0:l.hasPermission("reports.delete-own")&&t.value.user?.id===l.user.value?.id:!1);async function V(){g.value=!0;try{const{data:o}=await b.get(y.value);t.value=o.data}catch{w.push({name:"reports.index"})}g.value=!1}async function T(){try{await b.delete(y.value),u.success("Laporan dipadam."),w.push({name:"reports.index"})}catch{u.error("Gagal memadam laporan.")}m.value=!1}async function I(){p.value=!0;try{const{data:o}=await b.triggerAnalysis(y.value);o.status==="completed"?(t.value=o.data,u.success(o.message)):u.error(o.message||"AI analysis failed.")}catch(o){u.error(o.response?.data?.message||"Gagal mencetuskan analisis AI.")}p.value=!1}return R(V),(o,e)=>{const A=z("router-link");return i(),n("div",null,[g.value?(i(),L(G,{key:0,"full-page":""})):t.value?(i(),n(M,{key:1},[s("div",q,[s("div",null,[_(A,{to:{name:"reports.index"},class:"text-sm text-gray-500 hover:text-primary-600 mb-1 inline-block"},{default:x(()=>[...e[2]||(e[2]=[h("â† Kembali ke Laporan",-1)])]),_:1}),s("h1",U,a(t.value.title),1)]),s("div",J,[B.value?(i(),L(A,{key:0,to:{name:"reports.edit",params:{id:t.value.id}},class:"btn-secondary btn-sm"},{default:x(()=>[...e[3]||(e[3]=[h("Edit",-1)])]),_:1},8,["to"])):d("",!0),P.value?(i(),n("button",{key:1,onClick:e[0]||(e[0]=r=>m.value=!0),class:"btn-danger btn-sm"},"Padam")):d("",!0)])]),s("div",O,[s("div",Q,[s("div",W,[e[7]||(e[7]=s("div",{class:"card-header"},[s("h3",{class:"font-semibold text-gray-900"},"Butiran Laporan")],-1)),s("div",X,[s("div",Y,[s("div",null,[e[4]||(e[4]=s("span",{class:"text-gray-500"},"Kategori:",-1)),s("p",Z,a(t.value.category),1)]),s("div",null,[e[5]||(e[5]=s("span",{class:"text-gray-500"},"Tarikh:",-1)),s("p",ss,a(t.value.incident_date),1)])]),s("div",null,[e[6]||(e[6]=s("span",{class:"text-sm text-gray-500"},"Laporan:",-1)),s("div",{class:"mt-1 text-sm text-gray-700 prose prose-sm max-w-none",innerHTML:t.value.description},null,8,es)])])]),t.value.attachments?.length?(i(),n("div",ts,[s("div",as,[s("h3",is,"Lampiran ("+a(t.value.attachments.length)+")",1)]),s("div",ns,[s("ul",os,[(i(!0),n(M,null,N(t.value.attachments,r=>(i(),n("li",{key:r.id,class:"flex items-center justify-between py-2.5"},[s("div",rs,[e[8]||(e[8]=s("svg",{class:"h-4 w-4 text-gray-400 flex-shrink-0",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M18.375 12.739l-7.693 7.693a4.5 4.5 0 01-6.364-6.364l10.94-10.94A3 3 0 1119.5 7.372L8.552 18.32m.009-.01l-.01.01m5.699-9.941l-7.81 7.81a1.5 1.5 0 002.112 2.13"})],-1)),s("span",ls,a(r.original_name),1),s("span",ds,"("+a(r.file_size_human)+")",1)]),s("div",us,[r.view_url?(i(),n("a",{key:0,href:r.view_url,target:"_blank",title:"View",class:"inline-flex items-center justify-center h-8 w-8 rounded-md text-gray-500 hover:text-primary-600 hover:bg-primary-50 transition-colors"},[...e[9]||(e[9]=[s("svg",{class:"h-4.5 w-4.5",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z"}),s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})],-1)])],8,cs)):d("",!0),s("a",{href:r.download_url,target:"_blank",title:"Download",class:"inline-flex items-center justify-center h-8 w-8 rounded-md text-gray-500 hover:text-primary-600 hover:bg-primary-50 transition-colors"},[...e[10]||(e[10]=[s("svg",{class:"h-4.5 w-4.5",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3"})],-1)])],8,ms)])]))),128))])])])):d("",!0),s("div",ps,[s("div",vs,[e[11]||(e[11]=s("div",{class:"flex items-center gap-2"},[s("svg",{class:"h-5 w-5 text-indigo-500",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9.75 3.104v5.714a2.25 2.25 0 01-.659 1.591L5 14.5M9.75 3.104c-.251.023-.501.05-.75.082m.75-.082a24.301 24.301 0 014.5 0m0 0v5.714c0 .597.237 1.17.659 1.591L19.8 15.3M14.25 3.104c.251.023.501.05.75.082M19.8 15.3l-1.57.393A9.065 9.065 0 0112 15a9.065 9.065 0 00-6.23.693L5 14.5m14.8.8l1.402 1.402c1.232 1.232.65 3.318-1.067 3.611A48.309 48.309 0 0112 21c-2.773 0-5.491-.235-8.135-.687-1.718-.293-2.3-2.379-1.067-3.61L5 14.5"})]),s("h3",{class:"font-semibold text-gray-900"},"Analisis AI")],-1)),c(l).hasPermission("ai.trigger")?(i(),n("button",{key:0,onClick:I,disabled:p.value,class:"btn-secondary btn-sm text-xs"},a(p.value?"Menganalisis...":t.value.ai_analysis?"Analisis Semula":"Mulakan Analisis"),9,gs)):d("",!0)]),t.value.ai_analysis?(i(),n("div",ys,[s("div",_s,[s("div",xs,[e[12]||(e[12]=s("p",{class:"text-xs text-gray-500 mb-1"},"Tahap Risiko",-1)),_(F,{color:t.value.ai_analysis.risk_level?.color},{default:x(()=>[h(a(t.value.ai_analysis.risk_level?.label),1)]),_:1},8,["color"])]),s("div",fs,[e[13]||(e[13]=s("p",{class:"text-xs text-gray-500 mb-1"},"Skala Risiko",-1)),s("p",hs,a(t.value.ai_analysis.urgency_score)+"/10",1)])]),s("div",null,[e[14]||(e[14]=s("p",{class:"text-xs font-medium text-gray-500 mb-1"},"Ringkasan",-1)),s("p",ks,a(t.value.ai_analysis.summary),1)]),s("div",null,[e[15]||(e[15]=s("p",{class:"text-xs font-medium text-gray-500 mb-1"},"Tindakan Disyorkan",-1)),s("p",bs,a(t.value.ai_analysis.recommended_action),1)]),t.value.ai_analysis.related_issue?(i(),n("div",ws,[e[16]||(e[16]=s("p",{class:"text-xs font-medium text-gray-500 mb-1"},"Isu Berkaitan",-1)),s("p",As,a(t.value.ai_analysis.related_issue),1)])):d("",!0),s("p",Ls,"Dianalisis "+a(c(k)(t.value.ai_analysis.analyzed_at)),1)])):(i(),n("div",Ms,[s("p",Cs,"Tiada analisis AI lagi. "+a(c(l).hasPermission("ai.trigger")?'Klik "Mulakan Analisis" untuk bermula.':"Pentadbir boleh memulakan analisis."),1)]))])]),s("div",Ds,[s("div",js,[e[20]||(e[20]=s("div",{class:"card-header"},[s("h3",{class:"font-semibold text-gray-900"},"Maklumat")],-1)),s("div",Bs,[s("div",null,[e[17]||(e[17]=s("span",{class:"text-gray-500"},"Dihantar oleh:",-1)),s("p",Ps,a(t.value.user?.name),1)]),s("div",null,[e[18]||(e[18]=s("span",{class:"text-gray-500"},"Dicipta:",-1)),s("p",Vs,a(c(k)(t.value.created_at)),1)]),s("div",null,[e[19]||(e[19]=s("span",{class:"text-gray-500"},"Dikemas kini:",-1)),s("p",Ts,a(c(k)(t.value.updated_at)),1)])])])])])],64)):d("",!0),_(H,{modelValue:m.value,"onUpdate:modelValue":e[1]||(e[1]=r=>m.value=r),title:"Padam Laporan",message:"Adakah anda pasti mahu memadam laporan ini? Tindakan ini tidak boleh dibatalkan.","confirm-text":"Padam",danger:!0,onConfirm:T},null,8,["modelValue"])])}}};export{Hs as default};
