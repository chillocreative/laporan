import{r as c,o as U,c as o,a as s,f as P,g as b,s as j,F as x,d as h,w as z,t as m,e as _,v as M,q as V,n as K,i as O,j as A,k as i,h as f,L as H}from"./app-D7nogW7V.js";import{u as J}from"./useNotification-D2PjxE6j.js";import{r as k}from"./roles-DIWb6nTz.js";import{_ as N}from"./LoadingSpinner-CUYk7edN.js";import{_ as Q}from"./Alert-DQ1LPNQy.js";/* empty css            */import"./notifications-DUq4YrNs.js";const W={class:"max-w-3xl mx-auto"},X={class:"mb-6"},Y={class:"card"},Z={class:"card-body"},ee={key:0,class:"rounded-lg bg-red-50 p-3 text-sm text-red-700"},se={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},ae={class:"space-y-4"},te={class:"flex items-center gap-3 mb-3"},ne=["id","checked","indeterminate","onChange"],le=["for"],re={class:"text-xs text-gray-400"},ie={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2 ml-7"},oe=["value"],ue={key:0,class:"text-sm text-gray-400 mt-2"},de={class:"flex items-center justify-end gap-3 pt-4 border-t border-gray-100"},ce=["disabled"],xe={__name:"RoleEdit",props:{id:[String,Number]},setup(G){const B=G,R=K(),w=A(),S=J(),C=c(B.id||R.params.id),p=c(null),a=c({name:"",slug:"",permissions:[]}),u=c({}),y=c(!0),g=c(!1),v=c("");function E(){a.value.slug=a.value.name.toLowerCase().trim().replace(/[^a-z0-9\s-]/g,"").replace(/[\s]+/g,"-").replace(/-+/g,"-")}function I(n){const e=u.value[n]||[];return e.length>0&&e.every(l=>a.value.permissions.includes(l.id))}function T(n){const e=u.value[n]||[],l=e.filter(r=>a.value.permissions.includes(r.id)).length;return l>0&&l<e.length}function $(n){return(u.value[n]||[]).filter(l=>a.value.permissions.includes(l.id)).length}function q(n,e){const r=(u.value[n]||[]).map(t=>t.id);if(e){const t=new Set(a.value.permissions);r.forEach(d=>t.add(d)),a.value.permissions=[...t]}else a.value.permissions=a.value.permissions.filter(t=>!r.includes(t))}async function D(){y.value=!0;try{const[n,e]=await Promise.all([k.get(C.value),k.permissions()]);p.value=n.data.data,u.value=e.data.data,a.value={name:p.value.name,slug:p.value.slug,permissions:(p.value.permissions||[]).map(l=>l.id)}}catch{S.error("Gagal memuatkan data peranan."),w.push({name:"roles.index"})}y.value=!1}async function F(){g.value=!0,v.value="";try{await k.update(C.value,{name:a.value.name,slug:a.value.slug,permission_ids:a.value.permissions}),S.success("Peranan berjaya dikemas kini!"),w.push({name:"roles.index"})}catch(n){const e=n.response?.data?.errors;v.value=e?Object.values(e).flat()[0]:"Gagal mengemas kini peranan."}finally{g.value=!1}}return U(()=>D()),(n,e)=>{const l=O("router-link");return i(),o("div",W,[s("div",X,[P(l,{to:{name:"roles.index"},class:"text-sm text-gray-500 hover:text-primary-600 mb-1 inline-block"},{default:b(()=>[...e[3]||(e[3]=[f("â† Kembali ke Peranan",-1)])]),_:1}),e[4]||(e[4]=s("h1",{class:"page-title"},"Edit Peranan",-1))]),y.value?(i(),j(N,{key:0,"full-page":""})):(i(),o(x,{key:1},[p.value?.is_system?(i(),j(Q,{key:0,type:"warning",class:"mb-6"},{default:b(()=>[...e[5]||(e[5]=[f(" Ini adalah peranan sistem. Perubahan mungkin menjejaskan fungsi teras aplikasi. Teruskan dengan berhati-hati. ",-1)])]),_:1})):h("",!0),s("div",Y,[s("div",Z,[s("form",{onSubmit:z(F,["prevent"]),class:"space-y-6"},[v.value?(i(),o("div",ee,m(v.value),1)):h("",!0),s("div",se,[s("div",null,[e[6]||(e[6]=s("label",{class:"label-text"},"Nama Peranan *",-1)),_(s("input",{"onUpdate:modelValue":e[0]||(e[0]=r=>a.value.name=r),onInput:E,type:"text",required:"",class:"input-field",placeholder:"e.g. Content Manager"},null,544),[[M,a.value.name]])]),s("div",null,[e[7]||(e[7]=s("label",{class:"label-text"},"Slug *",-1)),_(s("input",{"onUpdate:modelValue":e[1]||(e[1]=r=>a.value.slug=r),type:"text",required:"",class:"input-field",placeholder:"e.g. content-manager"},null,512),[[M,a.value.slug]])])]),s("div",null,[e[8]||(e[8]=s("label",{class:"label-text mb-3"},"Kebenaran",-1)),s("div",ae,[(i(!0),o(x,null,V(u.value,(r,t)=>(i(),o("div",{key:t,class:"border border-gray-200 rounded-lg p-4"},[s("div",te,[s("input",{type:"checkbox",id:`group-${t}`,checked:I(t),indeterminate:T(t),onChange:d=>q(t,d.target.checked),class:"h-4 w-4 text-primary-600 rounded border-gray-300 focus:ring-primary-500"},null,40,ne),s("label",{for:`group-${t}`,class:"text-sm font-semibold text-gray-700 capitalize"},m(t),9,le),s("span",re," ("+m($(t))+"/"+m(r.length)+") ",1)]),s("div",ie,[(i(!0),o(x,null,V(r,d=>(i(),o("label",{key:d.id,class:"flex items-center gap-2 text-sm text-gray-600 cursor-pointer"},[_(s("input",{type:"checkbox",value:d.id,"onUpdate:modelValue":e[2]||(e[2]=L=>a.value.permissions=L),class:"h-4 w-4 text-primary-600 rounded border-gray-300 focus:ring-primary-500"},null,8,oe),[[H,a.value.permissions]]),f(" "+m(d.name),1)]))),128))])]))),128))]),Object.keys(u.value).length?h("",!0):(i(),o("p",ue,"Tiada kebenaran tersedia."))]),s("div",de,[P(l,{to:{name:"roles.index"},class:"btn-secondary"},{default:b(()=>[...e[9]||(e[9]=[f("Batal",-1)])]),_:1}),s("button",{type:"submit",disabled:g.value,class:"btn-primary"},m(g.value?"Menyimpan...":"Simpan Perubahan"),9,ce)])],32)])])],64))])}}};export{xe as default};
