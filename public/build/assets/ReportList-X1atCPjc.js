import{o as M,c as l,a,b as m,s as j,g as i,d as x,e as g,v as U,E as _,F as f,q as y,f as k,r as v,i as E,G as S,y as N,k as s,h as b,t as u}from"./app-CQob2CXV.js";import{u as O}from"./useAuth-DYlSfytT.js";import{r as D}from"./reports-BKaxkp3q.js";import{c as F}from"./categories-DtTSMAYT.js";import{u as K}from"./users-C-5nBVbu.js";import{r as $}from"./roles-Db10dzzm.js";import{R as z}from"./constants-BHE7jJoG.js";import{f as I}from"./formatters-mqXhrHnm.js";import{_ as q}from"./DataTable-CBHjvgis.js";import{_ as G}from"./Badge-z3vH81Ng.js";import{_ as H}from"./Pagination-DJfjs7f7.js";/* empty css            */import"./LoadingSpinner-C2gbwHS5.js";const J={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6 gap-4"},Q={class:"card mb-6"},W={class:"card-body"},X={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4"},Y=["value"],Z=["value"],ee=["value"],te=["value"],ae={class:"card"},se={class:"text-sm text-gray-700"},oe={key:1,class:"text-xs text-gray-400"},le={class:"text-xs text-gray-500"},re={class:"flex items-center gap-2 justify-end"},ie={class:"px-4 border-t border-gray-100"},be={__name:"ReportList",setup(ne){const d=O(),P=v([]),w=v([]),C=v([]),V=v([]),h=v(!0),c=S({currentPage:1,lastPage:1,total:0}),r=S({search:"",category:"",risk_level:"",user_id:"",role:""}),R=N(()=>C.value.filter(o=>!["super-admin","admin"].includes(o.slug)));let T;const A=()=>{clearTimeout(T),T=setTimeout(p,400)},B=[{key:"title",label:"Tajuk"},{key:"category",label:"Kategori"},{key:"user",label:"Pengguna"},{key:"ai_analysis",label:"Risiko"},{key:"incident_date",label:"Tarikh"}];async function p(o=1){h.value=!0;try{const t={...r,page:o,per_page:15};Object.keys(t).forEach(e=>{t[e]||delete t[e]});const{data:n}=await D.list(t);V.value=n.data,c.currentPage=n.meta?.current_page||1,c.lastPage=n.meta?.last_page||1,c.total=n.meta?.total||0}catch{}h.value=!1}function L(o){p(o)}return M(()=>{p(),F.active().then(({data:o})=>{P.value=o.data}).catch(()=>{}),d.hasPermission("users.view-all")&&K.list({per_page:1e3,exclude_admin_roles:!0}).then(({data:o})=>{w.value=o.data}).catch(()=>{}),(d.hasPermission("users.view-all")||d.hasPermission("roles.view"))&&$.list({per_page:100}).then(({data:o})=>{C.value=o.data}).catch(()=>{})}),(o,t)=>{const n=E("router-link");return s(),l("div",null,[a("div",J,[t[6]||(t[6]=a("div",null,[a("h1",{class:"page-title"},"Laporan"),a("p",{class:"page-subtitle"},"Urus dan jejaki semua laporan")],-1)),m(d).hasPermission("reports.create")?(s(),j(n,{key:0,to:{name:"reports.create"},class:"btn-primary"},{default:i(()=>[...t[5]||(t[5]=[b(" + Laporan Baru ",-1)])]),_:1})):x("",!0)]),a("div",Q,[a("div",W,[a("div",X,[g(a("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>r.search=e),onInput:A,type:"text",placeholder:"Cari laporan...",class:"input-field"},null,544),[[U,r.search]]),g(a("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>r.category=e),onChange:p,class:"input-field"},[t[7]||(t[7]=a("option",{value:""},"Semua Kategori",-1)),(s(!0),l(f,null,y(P.value,e=>(s(),l("option",{key:e,value:e},u(e),9,Y))),128))],544),[[_,r.category]]),g(a("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>r.risk_level=e),onChange:p,class:"input-field"},[t[8]||(t[8]=a("option",{value:""},"Semua Tahap Risiko",-1)),(s(!0),l(f,null,y(m(z),e=>(s(),l("option",{key:e.value,value:e.value},u(e.label),9,Z))),128))],544),[[_,r.risk_level]]),m(d).hasPermission("users.view-all")?g((s(),l("select",{key:0,"onUpdate:modelValue":t[3]||(t[3]=e=>r.user_id=e),onChange:p,class:"input-field"},[t[9]||(t[9]=a("option",{value:""},"Semua Pengguna",-1)),(s(!0),l(f,null,y(w.value,e=>(s(),l("option",{key:e.id,value:e.id},u(e.name),9,ee))),128))],544)),[[_,r.user_id]]):x("",!0),m(d).hasPermission("users.view-all")||m(d).hasPermission("roles.view")?g((s(),l("select",{key:1,"onUpdate:modelValue":t[4]||(t[4]=e=>r.role=e),onChange:p,class:"input-field"},[t[10]||(t[10]=a("option",{value:""},"Semua Peranan",-1)),(s(!0),l(f,null,y(R.value,e=>(s(),l("option",{key:e.id,value:e.name},u(e.name),9,te))),128))],544)),[[_,r.role]]):x("",!0)])])]),a("div",ae,[k(q,{columns:B,items:V.value,loading:h.value},{"cell-title":i(({item:e})=>[k(n,{to:{name:"reports.show",params:{id:e.id}},class:"font-medium text-primary-600 hover:text-primary-800"},{default:i(()=>[b(u(e.title),1)]),_:2},1032,["to"])]),"cell-user":i(({item:e})=>[a("span",se,u(e.user?.name||"N/A"),1)]),"cell-ai_analysis":i(({item:e})=>[e.ai_analysis?(s(),j(G,{key:0,color:e.ai_analysis.risk_level?.color},{default:i(()=>[b(u(e.ai_analysis.risk_level?.label),1)]),_:2},1032,["color"])):(s(),l("span",oe,"Menunggu"))]),"cell-incident_date":i(({item:e})=>[a("span",le,u(m(I)(e.incident_date)),1)]),actions:i(({item:e})=>[a("div",re,[k(n,{to:{name:"reports.show",params:{id:e.id}},class:"text-gray-400 hover:text-primary-600"},{default:i(()=>[...t[11]||(t[11]=[a("svg",{class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z"}),a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})],-1)])]),_:1},8,["to"])])]),_:1},8,["items","loading"]),a("div",ie,[k(H,{"current-page":c.currentPage,"last-page":c.lastPage,total:c.total,onPageChange:L},null,8,["current-page","last-page","total"])])])])}}};export{be as default};
