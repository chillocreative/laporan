import{o as N,c as r,s as C,F as R,a as e,f as _,g as x,t as a,d,q as T,b as c,r as y,i as P,y as f,j as S,n as F,k as o,h}from"./app-CkgA-AoW.js";import{u as $}from"./useAuth-DjetSSvL.js";import{u as E}from"./useNotification-Dz5CEwoZ.js";import{a as k}from"./formatters-mqXhrHnm.js";import{r as b}from"./reports-C3DfIrAh.js";import{_ as U}from"./Badge-DmpLveg_.js";import{_ as H}from"./LoadingSpinner-B-34TY8e.js";import{_ as q}from"./ConfirmDialog-kUwIuDDs.js";/* empty css            */import"./notifications-lGq0ZMx-.js";const G={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6 gap-4"},J={class:"page-title"},K={class:"flex gap-2"},O={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},Q={class:"lg:col-span-2 space-y-6"},W={class:"card"},X={class:"card-body space-y-4"},Y={class:"grid grid-cols-2 gap-4 text-sm"},Z={class:"font-medium"},ee={class:"font-medium"},se=["innerHTML"],te={key:0,class:"card"},ae={class:"card-header"},oe={class:"font-semibold text-gray-900"},re={class:"card-body"},ie={class:"divide-y divide-gray-100"},ne={class:"flex items-center gap-2 text-sm min-w-0"},le={class:"truncate"},de={class:"text-gray-400 flex-shrink-0"},ue={class:"flex items-center gap-1 flex-shrink-0 ml-3"},ce=["href"],me=["href"],pe={class:"card"},ye={class:"card-header flex items-center justify-between"},ve=["disabled"],ge={key:0,class:"card-body space-y-4"},_e={class:"grid grid-cols-2 gap-4"},xe={class:"text-center p-3 rounded-lg bg-gray-50"},fe={class:"text-center p-3 rounded-lg bg-gray-50"},he={class:"text-lg font-bold text-gray-900"},ke={class:"text-sm text-gray-700"},be={class:"text-sm text-gray-700"},we={key:0},Ae={class:"text-sm text-gray-700"},Ce={class:"text-xs text-gray-400"},Re={key:1,class:"card-body"},De={class:"text-sm text-gray-400 text-center py-4"},Me={class:"space-y-6"},je={class:"card"},Le={class:"card-body text-sm space-y-3"},Ve={class:"font-medium"},Be={class:"font-medium"},Ie={class:"font-medium"},qe={__name:"ReportShow",props:{id:[String,Number]},setup(D){const M=D,j=F(),w=S(),l=$(),u=E(),t=y(null),v=y(!0),m=y(!1),p=y(!1),g=f(()=>M.id||j.params.id),L=f(()=>t.value?l.hasPermission("reports.edit-any")?!0:l.hasPermission("reports.edit-own")&&t.value.user?.id===l.user.value?.id:!1),V=f(()=>t.value?l.hasPermission("reports.delete-any")?!0:l.hasPermission("reports.delete-own")&&t.value.user?.id===l.user.value?.id:!1);async function B(){v.value=!0;try{const{data:i}=await b.get(g.value);t.value=i.data}catch{w.push({name:"reports.index"})}v.value=!1}async function I(){try{await b.delete(g.value),u.success("Report deleted."),w.push({name:"reports.index"})}catch{u.error("Failed to delete report.")}m.value=!1}async function z(){p.value=!0;try{const{data:i}=await b.triggerAnalysis(g.value);i.status==="completed"?(t.value=i.data,u.success(i.message)):u.error(i.message||"AI analysis failed.")}catch(i){u.error(i.response?.data?.message||"Failed to trigger AI analysis.")}p.value=!1}return N(B),(i,s)=>{const A=P("router-link");return o(),r("div",null,[v.value?(o(),C(H,{key:0,"full-page":""})):t.value?(o(),r(R,{key:1},[e("div",G,[e("div",null,[_(A,{to:{name:"reports.index"},class:"text-sm text-gray-500 hover:text-primary-600 mb-1 inline-block"},{default:x(()=>[...s[2]||(s[2]=[h("â† Back to Reports",-1)])]),_:1}),e("h1",J,a(t.value.title),1)]),e("div",K,[L.value?(o(),C(A,{key:0,to:{name:"reports.edit",params:{id:t.value.id}},class:"btn-secondary btn-sm"},{default:x(()=>[...s[3]||(s[3]=[h("Edit",-1)])]),_:1},8,["to"])):d("",!0),V.value?(o(),r("button",{key:1,onClick:s[0]||(s[0]=n=>m.value=!0),class:"btn-danger btn-sm"},"Delete")):d("",!0)])]),e("div",O,[e("div",Q,[e("div",W,[s[7]||(s[7]=e("div",{class:"card-header"},[e("h3",{class:"font-semibold text-gray-900"},"Report Details")],-1)),e("div",X,[e("div",Y,[e("div",null,[s[4]||(s[4]=e("span",{class:"text-gray-500"},"Category:",-1)),e("p",Z,a(t.value.category),1)]),e("div",null,[s[5]||(s[5]=e("span",{class:"text-gray-500"},"Date:",-1)),e("p",ee,a(t.value.incident_date),1)])]),e("div",null,[s[6]||(s[6]=e("span",{class:"text-sm text-gray-500"},"Report:",-1)),e("div",{class:"mt-1 text-sm text-gray-700 prose prose-sm max-w-none",innerHTML:t.value.description},null,8,se)])])]),t.value.attachments?.length?(o(),r("div",te,[e("div",ae,[e("h3",oe,"Attachments ("+a(t.value.attachments.length)+")",1)]),e("div",re,[e("ul",ie,[(o(!0),r(R,null,T(t.value.attachments,n=>(o(),r("li",{key:n.id,class:"flex items-center justify-between py-2.5"},[e("div",ne,[s[8]||(s[8]=e("svg",{class:"h-4 w-4 text-gray-400 flex-shrink-0",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M18.375 12.739l-7.693 7.693a4.5 4.5 0 01-6.364-6.364l10.94-10.94A3 3 0 1119.5 7.372L8.552 18.32m.009-.01l-.01.01m5.699-9.941l-7.81 7.81a1.5 1.5 0 002.112 2.13"})],-1)),e("span",le,a(n.original_name),1),e("span",de,"("+a(n.file_size_human)+")",1)]),e("div",ue,[n.view_url?(o(),r("a",{key:0,href:n.view_url,target:"_blank",title:"View",class:"inline-flex items-center justify-center h-8 w-8 rounded-md text-gray-500 hover:text-primary-600 hover:bg-primary-50 transition-colors"},[...s[9]||(s[9]=[e("svg",{class:"h-4.5 w-4.5",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})],-1)])],8,ce)):d("",!0),e("a",{href:n.download_url,target:"_blank",title:"Download",class:"inline-flex items-center justify-center h-8 w-8 rounded-md text-gray-500 hover:text-primary-600 hover:bg-primary-50 transition-colors"},[...s[10]||(s[10]=[e("svg",{class:"h-4.5 w-4.5",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3"})],-1)])],8,me)])]))),128))])])])):d("",!0),e("div",pe,[e("div",ye,[s[11]||(s[11]=e("div",{class:"flex items-center gap-2"},[e("svg",{class:"h-5 w-5 text-indigo-500",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9.75 3.104v5.714a2.25 2.25 0 01-.659 1.591L5 14.5M9.75 3.104c-.251.023-.501.05-.75.082m.75-.082a24.301 24.301 0 014.5 0m0 0v5.714c0 .597.237 1.17.659 1.591L19.8 15.3M14.25 3.104c.251.023.501.05.75.082M19.8 15.3l-1.57.393A9.065 9.065 0 0112 15a9.065 9.065 0 00-6.23.693L5 14.5m14.8.8l1.402 1.402c1.232 1.232.65 3.318-1.067 3.611A48.309 48.309 0 0112 21c-2.773 0-5.491-.235-8.135-.687-1.718-.293-2.3-2.379-1.067-3.61L5 14.5"})]),e("h3",{class:"font-semibold text-gray-900"},"AI Analysis")],-1)),c(l).hasPermission("ai.trigger")?(o(),r("button",{key:0,onClick:z,disabled:p.value,class:"btn-secondary btn-sm text-xs"},a(p.value?"Analyzing...":t.value.ai_analysis?"Re-analyze":"Trigger Analysis"),9,ve)):d("",!0)]),t.value.ai_analysis?(o(),r("div",ge,[e("div",_e,[e("div",xe,[s[12]||(s[12]=e("p",{class:"text-xs text-gray-500 mb-1"},"Risk Level",-1)),_(U,{color:t.value.ai_analysis.risk_level?.color},{default:x(()=>[h(a(t.value.ai_analysis.risk_level?.label),1)]),_:1},8,["color"])]),e("div",fe,[s[13]||(s[13]=e("p",{class:"text-xs text-gray-500 mb-1"},"Urgency",-1)),e("p",he,a(t.value.ai_analysis.urgency_score)+"/10",1)])]),e("div",null,[s[14]||(s[14]=e("p",{class:"text-xs font-medium text-gray-500 mb-1"},"Summary",-1)),e("p",ke,a(t.value.ai_analysis.summary),1)]),e("div",null,[s[15]||(s[15]=e("p",{class:"text-xs font-medium text-gray-500 mb-1"},"Recommended Action",-1)),e("p",be,a(t.value.ai_analysis.recommended_action),1)]),t.value.ai_analysis.related_issue?(o(),r("div",we,[s[16]||(s[16]=e("p",{class:"text-xs font-medium text-gray-500 mb-1"},"Related Issue",-1)),e("p",Ae,a(t.value.ai_analysis.related_issue),1)])):d("",!0),e("p",Ce,"Analyzed "+a(c(k)(t.value.ai_analysis.analyzed_at)),1)])):(o(),r("div",Re,[e("p",De,"No AI analysis yet. "+a(c(l).hasPermission("ai.trigger")?'Click "Trigger Analysis" to start.':"An admin can trigger analysis."),1)]))])]),e("div",Me,[e("div",je,[s[20]||(s[20]=e("div",{class:"card-header"},[e("h3",{class:"font-semibold text-gray-900"},"Info")],-1)),e("div",Le,[e("div",null,[s[17]||(s[17]=e("span",{class:"text-gray-500"},"Submitted by:",-1)),e("p",Ve,a(t.value.user?.name),1)]),e("div",null,[s[18]||(s[18]=e("span",{class:"text-gray-500"},"Created:",-1)),e("p",Be,a(c(k)(t.value.created_at)),1)]),e("div",null,[s[19]||(s[19]=e("span",{class:"text-gray-500"},"Updated:",-1)),e("p",Ie,a(c(k)(t.value.updated_at)),1)])])])])])],64)):d("",!0),_(q,{modelValue:m.value,"onUpdate:modelValue":s[1]||(s[1]=n=>m.value=n),title:"Delete Report",message:"Are you sure you want to delete this report? This action cannot be undone.","confirm-text":"Delete",danger:!0,onConfirm:I},null,8,["modelValue"])])}}};export{qe as default};
